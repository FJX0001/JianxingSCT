<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCC 到 SRT 字幕转换工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background: rgba(25, 25, 45, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            margin-top: 30px;
            margin-bottom: 40px;
        }
        
        header {
            background: linear-gradient(to right, #9C27B0, #673AB7);
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .content {
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .upload-area {
            border: 3px dashed #9C27B0;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(156, 39, 176, 0.05);
        }
        
        .upload-area:hover {
            background: rgba(156, 39, 176, 0.1);
            border-color: #E91E63;
        }
        
        .upload-icon {
            font-size: 3.5rem;
            color: #9C27B0;
            margin-bottom: 15px;
        }
        
        .upload-text h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .upload-text p {
            color: #aaa;
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .btn {
            background: linear-gradient(to right, #9C27B0, #673AB7);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.6);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .preview-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .preview-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        
        .preview-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .preview-container {
                flex-direction: column;
            }
        }
        
        .preview-box {
            flex: 1;
            min-width: 300px;
            background: rgba(30, 30, 50, 0.8);
            border-radius: 10px;
            padding: 20px;
            overflow: auto;
            max-height: 400px;
        }
        
        .preview-box h4 {
            color: #9C27B0;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #444;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .preview-content {
            font-family: monospace;
            white-space: pre-wrap;
            line-height: 1.5;
            font-size: 0.9rem;
            color: #ddd;
        }
        
        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #F44336;
            padding: 15px;
            border-radius: 4px;
            color: #ff8a80;
            display: none;
        }
        
        .file-info {
            background: rgba(30, 30, 50, 0.8);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .file-name {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }
        
        .file-size {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .github-link {
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            width: 100%;
            max-width: 900px;
        }
        
        .github-link a {
            color: #9C27B0;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .github-link a:hover {
            text-decoration: underline;
        }
        
        footer {
            margin-top: 30px;
            text-align: center;
            color: #777;
            font-size: 0.9rem;
            padding: 20px;
        }
        
        .example {
            margin-top: 20px;
            background: rgba(30, 30, 50, 0.8);
            border-radius: 10px;
            padding: 20px;
        }
        
        .example h3 {
            color: #9C27B0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .example-code {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .example-box {
            flex: 1;
            min-width: 300px;
            background: rgba(20, 20, 35, 0.9);
            border-radius: 8px;
            padding: 15px;
            overflow: auto;
        }
        
        .example-box h4 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .highlight {
            color: #FF9800;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-closed-captioning"></i> BCC 到 SRT 字幕转换工具</h1>
            <p class="subtitle">上传B站BCC字幕文件，自动转换为标准的SRT字幕格式，并保留原始文件名下载</p>
        </header>
        
        <div class="content">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-file-upload"></i>
                </div>
                <div class="upload-text">
                    <h3>上传BCC字幕文件</h3>
                    <p>拖放文件到此处或点击上传，支持 .bcc 或 .json 格式</p>
                    <button class="btn" id="uploadBtn">
                        <i class="fas fa-upload"></i> 选择文件
                    </button>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".bcc,.json">
            </div>
            
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-triangle"></i> <span id="errorText">错误信息</span>
            </div>
            
            <div id="fileInfo" class="file-info" style="display: none;">
                <div class="file-name">
                    <i class="fas fa-file-alt"></i>
                    <span id="fileName">文件名</span>
                </div>
                <div class="file-size" id="fileSize">文件大小</div>
            </div>
            
            <div class="preview-area" id="previewArea" style="display: none;">
                <div class="preview-title">
                    <h3>预览转换结果</h3>
                    <div class="actions">
                        <button class="btn" id="convertBtn">
                            <i class="fas fa-sync-alt"></i> 转换字幕
                        </button>
                        <button class="btn" id="downloadBtn" disabled>
                            <i class="fas fa-download"></i> 下载SRT文件
                        </button>
                        <button class="btn" id="resetBtn">
                            <i class="fas fa-redo"></i> 重置
                        </button>
                    </div>
                </div>
                
                <div class="preview-container">
                    <div class="preview-box">
                        <h4><i class="fas fa-file-code"></i> BCC 原始内容</h4>
                        <div class="preview-content" id="bccPreview"></div>
                    </div>
                    <div class="preview-box">
                        <h4><i class="fas fa-file-alt"></i> SRT 转换结果</h4>
                        <div class="preview-content" id="srtPreview"></div>
                    </div>
                </div>
            </div>
            
            <div class="example">
                <h3><i class="fas fa-code"></i> 格式示例</h3>
                <div class="example-code">
                    <div class="example-box">
                        <h4>BCC 格式示例</h4>
                        <pre class="preview-content">{
  "font_size": 0.4,
  "font_color": "#FFFFFF",
  "body": [
    {
      "from": 7.12,
      "to": 8.96,
      "location": 2,
      "content": "欢迎回来"
    },
    {
      "from": 10.5,
      "to": 13.2,
      "location": 2,
      "content": "这是第二行字幕"
    }
  ]
}</pre>
                    </div>
                    <div class="example-box">
                        <h4>SRT 格式示例</h4>
                        <pre class="preview-content">1
00:00:07,120 --> 00:00:08,960
欢迎回来

2
00:00:10,500 --> 00:00:13,200
这是第二行字幕</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="github-link">
        <a href="https://github.com/" target="_blank">
            <i class="fab fa-github"></i> 在GitHub上部署此工具
        </a>
        <p style="margin-top: 10px; font-size: 0.9rem; color: #aaa;">
            将本项目克隆到您的GitHub仓库，启用GitHub Pages即可部署
        </p>
    </div>
    
    <footer>
        <p>BCC 到 SRT 字幕转换工具 &copy; 2023 | 专为B站字幕转换设计</p>
    </footer>

    <script>
        // DOM元素
        const uploadArea = document.getElementById('uploadArea');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const previewArea = document.getElementById('previewArea');
        const bccPreview = document.getElementById('bccPreview');
        const srtPreview = document.getElementById('srtPreview');
        const convertBtn = document.getElementById('convertBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        
        // 变量
        let currentFile = null;
        let originalFileName = '';
        let srtContent = '';
        
        // 事件监听
        uploadBtn.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#E91E63';
            uploadArea.style.background = 'rgba(156, 39, 176, 0.15)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#9C27B0';
            uploadArea.style.background = 'rgba(156, 39, 176, 0.05)';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#9C27B0';
            uploadArea.style.background = 'rgba(156, 39, 176, 0.05)';
            
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFile(e.target.files[0]);
            }
        });
        
        convertBtn.addEventListener('click', convertBCCtoSRT);
        downloadBtn.addEventListener('click', downloadSRT);
        resetBtn.addEventListener('click', resetTool);
        
        // 处理上传的文件
        function handleFile(file) {
            // 验证文件类型
            const validExtensions = ['.bcc', '.json'];
            const fileExtension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
            
            if (!validExtensions.includes(fileExtension)) {
                showError('请上传 .bcc 或 .json 格式的文件');
                return;
            }
            
            // 验证文件大小（最大5MB）
            if (file.size > 5 * 1024 * 1024) {
                showError('文件大小不能超过5MB');
                return;
            }
            
            currentFile = file;
            originalFileName = file.name.replace(fileExtension, '');
            
            // 显示文件信息
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'flex';
            
            // 读取并预览文件内容
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const fileContent = e.target.result;
                    bccPreview.textContent = fileContent;
                    
                    // 验证是否为有效的JSON
                    JSON.parse(fileContent);
                    
                    // 显示预览区域
                    previewArea.style.display = 'block';
                    errorMessage.style.display = 'none';
                    downloadBtn.disabled = true;
                    
                    // 自动滚动到预览区域
                    previewArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } catch (err) {
                    showError('文件格式错误，请上传有效的BCC字幕文件（JSON格式）');
                }
            };
            reader.readAsText(file);
        }
        
        // 转换BCC到SRT
        function convertBCCtoSRT() {
            try {
                const bccJson = JSON.parse(bccPreview.textContent);
                
                // 验证BCC格式
                if (!bccJson.body || !Array.isArray(bccJson.body)) {
                    throw new Error('BCC格式错误：缺少有效的字幕内容');
                }
                
                // 转换字幕
                srtContent = '';
                let index = 1;
                
                // 对字幕按开始时间排序
                const sortedBody = [...bccJson.body].sort((a, b) => a.from - b.from);
                
                sortedBody.forEach(item => {
                    // 验证必需字段
                    if (item.from === undefined || item.to === undefined || !item.content) {
                        return; // 跳过无效条目
                    }
                    
                    // 转换时间格式
                    const startTime = secondsToSRTTime(item.from);
                    const endTime = secondsToSRTTime(item.to);
                    
                    // 构建SRT条目
                    srtContent += `${index}\n`;
                    srtContent += `${startTime} --> ${endTime}\n`;
                    srtContent += `${item.content}\n\n`;
                    
                    index++;
                });
                
                if (srtContent === '') {
                    throw new Error('未找到有效的字幕内容');
                }
                
                // 显示SRT预览
                srtPreview.textContent = srtContent;
                
                // 启用下载按钮
                downloadBtn.disabled = false;
                
                // 显示成功消息
                showError(`转换成功！共转换 ${index-1} 条字幕`, false);
                
            } catch (err) {
                showError(`转换失败：${err.message}`);
                srtPreview.textContent = '转换失败，请检查BCC文件格式是否正确。';
            }
        }
        
        // 将秒数转换为SRT时间格式
        function secondsToSRTTime(seconds) {
            // 处理负数
            if (seconds < 0) seconds = 0;
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            const milliseconds = Math.round((seconds % 1) * 1000);
            
            // 格式化为两位数或三位数
            return `${padZero(hours)}:${padZero(minutes)}:${padZero(secs)},${padZero(milliseconds, 3)}`;
        }
        
        // 补零函数
        function padZero(num, length = 2) {
            return num.toString().padStart(length, '0');
        }
        
        // 下载SRT文件
        function downloadSRT() {
            if (!srtContent) return;
            
            // 创建Blob对象
            const blob = new Blob([srtContent], { type: 'text/plain;charset=utf-8' });
            
            // 创建下载链接
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${originalFileName}.srt`;
            
            // 触发下载
            document.body.appendChild(a);
            a.click();
            
            // 清理
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        // 重置工具
        function resetTool() {
            currentFile = null;
            originalFileName = '';
            srtContent = '';
            
            fileInput.value = '';
            bccPreview.textContent = '';
            srtPreview.textContent = '';
            
            fileInfo.style.display = 'none';
            previewArea.style.display = 'none';
            errorMessage.style.display = 'none';
            downloadBtn.disabled = true;
        }
        
        // 显示错误消息
        function showError(message, isError = true) {
            errorText.textContent = message;
            errorMessage.style.display = 'block';
            errorMessage.style.background = isError 
                ? 'rgba(244, 67, 54, 0.1)' 
                : 'rgba(76, 175, 80, 0.1)';
            errorMessage.style.borderLeftColor = isError 
                ? '#F44336' 
                : '#4CAF50';
        }
        
        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // 加载示例数据
        function loadExampleData() {
            const exampleBCC = {
                "font_size": 0.4,
                "font_color": "#FFFFFF",
                "background_alpha": 0.5,
                "background_color": "#9C27B0",
                "stroke": "none",
                "body": [
                    {
                        "from": 7.12,
                        "to": 8.96,
                        "location": 2,
                        "content": "欢迎回来"
                    },
                    {
                        "from": 10.5,
                        "to": 13.2,
                        "location": 2,
                        "content": "这是第二行字幕"
                    },
                    {
                        "from": 15.8,
                        "to": 18.9,
                        "location": 2,
                        "content": "第三行字幕，用于演示转换效果"
                    }
                ]
            };
            
            bccPreview.textContent = JSON.stringify(exampleBCC, null, 2);
            previewArea.style.display = 'block';
            fileInfo.style.display = 'flex';
            fileName.textContent = "Example.bcc";
            fileSize.textContent = "示例文件";
            
            // 自动转换示例
            setTimeout(convertBCCtoSRT, 500);
        }
        
        // 页面加载完成后加载示例数据
        document.addEventListener('DOMContentLoaded', loadExampleData);
    </script>
</body>
</html>
